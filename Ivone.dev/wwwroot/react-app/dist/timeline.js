import{j as t,r as o,c as U,R as L}from"./client.js";import{L as R}from"./login.js";const P=s=>r=>localStorage.getItem("user")?t.jsx(s,{...r}):t.jsx(R,{}),B=s=>{if(!s)return"";const r=new Date(s),n=x=>String(x).padStart(2,"0"),d=r.getFullYear(),c=n(r.getMonth()+1),m=n(r.getDate()),f=n(r.getHours()),h=n(r.getMinutes());return`${d}-${c}-${m}T${f}:${h}`},G=({event:s,onEdit:r,onDelete:n})=>{const d=new Date(s.date),c=d.toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}),m=d.getHours(),f=d.getMinutes(),h=m!==0||f!==0,x=h?d.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"";return t.jsxs("div",{className:"flex mb-8 items-start",children:[t.jsx("div",{className:"w-1/4 pr-4 text-right",children:t.jsx("div",{className:"inline-block bg-indigo-500 text-white px-3 py-1 rounded-full font-bold",children:c})}),t.jsxs("div",{className:"w-3/4 pl-4 border-l-4 border-gray-300",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("h3",{className:"text-2xl font-semibold",children:s.title}),t.jsxs("div",{className:"flex space-x-2",children:[t.jsx("button",{onClick:()=>r(s),title:"Edit",children:t.jsx("span",{role:"img","aria-label":"edit",children:"✏️"})}),t.jsx("button",{onClick:()=>n(s),title:"Delete",children:t.jsx("span",{role:"img","aria-label":"delete",children:"❌"})})]})]}),t.jsx("p",{className:"text-gray-700",children:s.notes}),s.address&&t.jsx("a",{href:`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(s.address)}`,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-blue-600 underline",children:"+ Google Maps"}),h&&t.jsx("div",{className:"text-sm text-gray-500",children:x})]})]})},H=()=>{const[s,r]=o.useState([]),[n,d]=o.useState(null),[c,m]=o.useState([]),[f,h]=o.useState(!1),[x,D]=o.useState("add"),[u,g]=o.useState({date:"",title:"",notes:"",address:""}),[w,y]=o.useState(!1),[Y,_]=o.useState(""),k=localStorage.getItem("user"),j=k?JSON.parse(k):null,[N,T]=o.useState(null);o.useEffect(()=>{j&&j.email&&fetch(`/api/users/byEmail?email=${encodeURIComponent(j.email)}`).then(e=>{if(!e.ok)throw new Error("User not found");return e.json()}).then(e=>{T(e.id)}).catch(e=>console.error("Error fetching user id:",e))},[j]),o.useEffect(()=>{N&&fetch(`/api/timeline/user/${N}`).then(e=>e.json()).then(e=>{r(e),e.length>0&&d(e[0].id)}).catch(e=>console.error("Error fetching timelines:",e))},[N]),o.useEffect(()=>{n&&fetch(`/api/timeline/${n}/events`).then(e=>e.json()).then(e=>m(e.sort((i,l)=>new Date(i.date)-new Date(l.date)))).catch(e=>console.error("Error fetching events:",e))},[n]);const I=()=>{D("add");const e=new Date;e.setHours(0,0,0,0),g({date:e.toISOString(),title:"",notes:"",address:""}),y(!1),h(!0)},$=e=>{D("edit"),g(e),y(!!(e.address&&e.address.trim()!=="")),h(!0)},v=()=>h(!1),b=e=>{const{name:i,value:l,type:a,checked:p}=e.target;a==="checkbox"&&i==="isAddress"?(y(p),p||g(S=>({...S,address:""}))):g(S=>({...S,[i]:l}))},M=async()=>{const e={...u,address:w?u.address:""};if(x==="add"){const i=await fetch(`/api/timeline/${n}/events`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(i.ok){const l=await i.json();m([...c,l].sort((a,p)=>new Date(a.date)-new Date(p.date)))}}else if((await fetch(`/api/timeline/events/${u.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).ok){const l=c.map(a=>a.id===u.id?e:a);m(l.sort((a,p)=>new Date(a.date)-new Date(p.date)))}v()},A=async e=>{window.confirm(`Are you sure you want to delete "${e.title}"?`)&&(await fetch(`/api/timeline/events/${e.id}`,{method:"DELETE"})).ok&&m(c.filter(l=>l.id!==e.id))},O=async()=>{const e=prompt("Enter target user's ID to share with:");e&&(await fetch(`/api/timeline/share?timelineId=${n}&userId=${e}`,{method:"POST"}),alert("Timeline shared!"))};let C="";const E=[];return c.forEach((e,i)=>{const a=new Date(e.date).toLocaleString("en-GB",{month:"long",year:"numeric"});a!==C&&(E.push(t.jsxs("div",{className:"mb-4",children:[t.jsx("hr",{className:"border-t border-gray-300"}),t.jsx("div",{className:"text-center text-gray-600 mt-2",children:a})]},`separator-${i}`)),C=a),E.push(t.jsx(G,{event:e,onEdit:$,onDelete:A},e.id))}),t.jsxs("div",{className:"container mx-auto px-6 py-10",children:[t.jsxs("div",{className:"flex justify-between items-center mb-8",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-4xl font-bold",children:"My Timelines"}),t.jsx("select",{value:n||"",onChange:e=>d(Number(e.target.value)),className:"border p-2 rounded mt-2",children:s.map(e=>t.jsx("option",{value:e.id,children:e.name},e.id))})]}),t.jsxs("div",{className:"flex space-x-4",children:[t.jsx("button",{onClick:I,className:"bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600",children:"Add New"}),t.jsx("button",{onClick:O,className:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600",children:"Share"})]})]}),t.jsxs("div",{className:"flex",children:[t.jsx("div",{className:"w-1/4 relative",children:t.jsx("div",{className:"absolute top-0 bottom-0 right-0 border-l-4 border-indigo-500"})}),t.jsx("div",{className:"w-3/4",children:E})]}),f&&t.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50",onClick:()=>v(),children:t.jsxs("div",{className:"bg-white rounded p-6 w-96",onClick:e=>e.stopPropagation(),children:[t.jsx("h2",{className:"text-xl font-bold mb-4",children:x==="add"?"Add New Event":"Edit Event"}),t.jsxs("label",{className:"block mb-2",children:["Date & Time:",t.jsx("input",{type:"datetime-local",name:"date",value:B(u.date),onChange:b,className:"border rounded px-2 py-1 w-full"})]}),t.jsxs("label",{className:"block mb-2",children:["Title:",t.jsx("input",{type:"text",name:"title",value:u.title,onChange:b,className:"border rounded px-2 py-1 w-full"})]}),t.jsxs("label",{className:"block mb-2",children:["Notes:",t.jsx("textarea",{name:"notes",value:u.notes,onChange:b,className:"border rounded px-2 py-1 w-full"})]}),t.jsxs("label",{className:"block mb-2",children:[t.jsx("input",{type:"checkbox",name:"isAddress",checked:w,onChange:b,className:"mr-2"}),"Is address"]}),w&&t.jsxs("label",{className:"block mb-4",children:["Address:",t.jsx("input",{type:"text",name:"address",value:u.address,onChange:b,className:"border rounded px-2 py-1 w-full"})]}),t.jsxs("div",{className:"flex justify-end space-x-4",children:[t.jsx("button",{onClick:v,className:"px-4 py-2 border rounded",children:"Cancel"}),t.jsx("button",{onClick:M,className:"px-4 py-2 bg-blue-500 text-white rounded",children:x==="add"?"Add":"Save"})]})]})})]})},J=P(H),F=window.appData||[],q=document.getElementById("timeline-root"),z=U.createRoot(q);z.render(t.jsx(L.StrictMode,{children:t.jsx(J,{events:F})}));
