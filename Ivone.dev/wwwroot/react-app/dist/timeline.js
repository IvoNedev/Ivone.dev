var L=Object.defineProperty;var W=(s,n,r)=>n in s?L(s,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[n]=r;var j=(s,n,r)=>W(s,typeof n!="symbol"?n+"":n,r);import{j as e,r as l,c as _,R as P}from"./client.js";import{G as B,a as F}from"./index.esm.js";new TextEncoder;const O=new TextDecoder;function z(s){if(Uint8Array.fromBase64)return Uint8Array.fromBase64(s);const n=atob(s),r=new Uint8Array(n.length);for(let a=0;a<n.length;a++)r[a]=n.charCodeAt(a);return r}function H(s){if(Uint8Array.fromBase64)return Uint8Array.fromBase64(typeof s=="string"?s:O.decode(s),{alphabet:"base64url"});let n=s;n instanceof Uint8Array&&(n=O.decode(n)),n=n.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return z(n)}catch{throw new TypeError("The input to be decoded is not correctly encoded.")}}class A extends Error{constructor(r,a){var o;super(r,a);j(this,"code","ERR_JOSE_GENERIC");this.name=this.constructor.name,(o=Error.captureStackTrace)==null||o.call(Error,this,this.constructor)}}j(A,"code","ERR_JOSE_GENERIC");class p extends A{constructor(){super(...arguments);j(this,"code","ERR_JWT_INVALID")}}j(p,"code","ERR_JWT_INVALID");function V(s){return typeof s=="object"&&s!==null}const q=s=>{if(!V(s)||Object.prototype.toString.call(s)!=="[object Object]")return!1;if(Object.getPrototypeOf(s)===null)return!0;let n=s;for(;Object.getPrototypeOf(n)!==null;)n=Object.getPrototypeOf(n);return Object.getPrototypeOf(s)===n};function Y(s){if(typeof s!="string")throw new p("JWTs must use Compact JWS serialization, JWT must be a string");const{1:n,length:r}=s.split(".");if(r===5)throw new p("Only JWTs using Compact JWS serialization can be decoded");if(r!==3)throw new p("Invalid JWT");if(!n)throw new p("JWTs must contain a payload");let a;try{a=H(n)}catch{throw new p("Failed to base64url decode the payload")}let o;try{o=JSON.parse(O.decode(a))}catch{throw new p("Failed to parse the decoded payload as JSON")}if(!q(o))throw new p("Invalid JWT Claims Set");return o}const K=()=>{const s=r=>{const a=Y(r.credential);localStorage.setItem("user",JSON.stringify(a)),window.location.reload()},n=()=>{alert("Google Sign In was unsuccessful. Try again later")};return e.jsx(B,{clientId:"401410826720-1vl5fnvuts7pu5mk5l3hovrgcemdoc7l.apps.googleusercontent.com",children:e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"p-6 bg-white rounded shadow-md",children:[e.jsx("h2",{className:"text-2xl mb-4",children:"Login with Google"}),e.jsx(F,{onSuccess:s,onError:n})]})})})},Q=s=>n=>localStorage.getItem("user")?e.jsx(s,{...n}):e.jsx(K,{}),X=s=>{if(!s)return"";const n=new Date(s),r=x=>String(x).padStart(2,"0"),a=n.getFullYear(),o=r(n.getMonth()+1),m=r(n.getDate()),g=r(n.getHours()),h=r(n.getMinutes());return`${a}-${o}-${m}T${g}:${h}`},Z=({event:s,onEdit:n,onDelete:r})=>{const a=new Date(s.date),o=a.toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}),m=a.getHours(),g=a.getMinutes(),h=m!==0||g!==0,x=h?a.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"";return e.jsxs("div",{className:"flex mb-8 items-start",children:[e.jsx("div",{className:"w-1/4 pr-4 text-right",children:e.jsx("div",{className:"inline-block bg-indigo-500 text-white px-3 py-1 rounded-full font-bold",children:o})}),e.jsxs("div",{className:"w-3/4 pl-4 border-l-4 border-gray-300",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-2xl font-semibold",children:s.title}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>n(s),title:"Edit",children:e.jsx("span",{role:"img","aria-label":"edit",children:"✏️"})}),e.jsx("button",{onClick:()=>r(s),title:"Delete",children:e.jsx("span",{role:"img","aria-label":"delete",children:"❌"})})]})]}),e.jsx("p",{className:"text-gray-700",children:s.notes}),s.address&&e.jsx("a",{href:`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(s.address)}`,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-blue-600 underline",children:"+ Google Maps"}),h&&e.jsx("div",{className:"text-sm text-gray-500",children:x})]})]})},ee=()=>{const[s,n]=l.useState([]),[r,a]=l.useState(null),[o,m]=l.useState([]),[g,h]=l.useState(!1),[x,C]=l.useState("add"),[u,y]=l.useState({date:"",title:"",notes:"",address:""}),[N,v]=l.useState(!1),[ae,oe]=l.useState(""),D=localStorage.getItem("user"),w=D?JSON.parse(D):null,[E,J]=l.useState(null);l.useEffect(()=>{w&&w.email&&fetch(`/api/users/byEmail?email=${encodeURIComponent(w.email)}`).then(t=>{if(!t.ok)throw new Error("User not found");return t.json()}).then(t=>{J(t.id)}).catch(t=>console.error("Error fetching user id:",t))},[w]),l.useEffect(()=>{E&&fetch(`/api/timeline/user/${E}`).then(t=>t.json()).then(t=>{n(t),t.length>0&&a(t[0].id)}).catch(t=>console.error("Error fetching timelines:",t))},[E]),l.useEffect(()=>{r&&fetch(`/api/timeline/${r}/events`).then(t=>t.json()).then(t=>m(t.sort((c,d)=>new Date(c.date)-new Date(d.date)))).catch(t=>console.error("Error fetching events:",t))},[r]);const $=()=>{C("add");const t=new Date;t.setHours(0,0,0,0),y({date:t.toISOString(),title:"",notes:"",address:""}),v(!1),h(!0)},M=t=>{C("edit"),y(t),v(!!(t.address&&t.address.trim()!=="")),h(!0)},S=()=>h(!1),b=t=>{const{name:c,value:d,type:i,checked:f}=t.target;i==="checkbox"&&c==="isAddress"?(v(f),f||y(I=>({...I,address:""}))):y(I=>({...I,[c]:d}))},R=async()=>{const t={...u,address:N?u.address:""};if(x==="add"){const c=await fetch(`/api/timeline/${r}/events`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(c.ok){const d=await c.json();m([...o,d].sort((i,f)=>new Date(i.date)-new Date(f.date)))}}else if((await fetch(`/api/timeline/events/${u.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).ok){const d=o.map(i=>i.id===u.id?t:i);m(d.sort((i,f)=>new Date(i.date)-new Date(f.date)))}S()},U=async t=>{window.confirm(`Are you sure you want to delete "${t.title}"?`)&&(await fetch(`/api/timeline/events/${t.id}`,{method:"DELETE"})).ok&&m(o.filter(d=>d.id!==t.id))},G=async()=>{const t=prompt("Enter target user's ID to share with:");t&&(await fetch(`/api/timeline/share?timelineId=${r}&userId=${t}`,{method:"POST"}),alert("Timeline shared!"))};let k="";const T=[];return o.forEach((t,c)=>{const i=new Date(t.date).toLocaleString("en-GB",{month:"long",year:"numeric"});i!==k&&(T.push(e.jsxs("div",{className:"mb-4",children:[e.jsx("hr",{className:"border-t border-gray-300"}),e.jsx("div",{className:"text-center text-gray-600 mt-2",children:i})]},`separator-${c}`)),k=i),T.push(e.jsx(Z,{event:t,onEdit:M,onDelete:U},t.id))}),e.jsxs("div",{className:"container mx-auto px-6 py-10",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold",children:"My Timelines"}),e.jsx("select",{value:r||"",onChange:t=>a(Number(t.target.value)),className:"border p-2 rounded mt-2",children:s.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))})]}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("button",{onClick:$,className:"bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600",children:"Add New"}),e.jsx("button",{onClick:G,className:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600",children:"Share"})]})]}),e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-1/4 relative",children:e.jsx("div",{className:"absolute top-0 bottom-0 right-0 border-l-4 border-indigo-500"})}),e.jsx("div",{className:"w-3/4",children:T})]}),g&&e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50",onClick:()=>S(),children:e.jsxs("div",{className:"bg-white rounded p-6 w-96",onClick:t=>t.stopPropagation(),children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:x==="add"?"Add New Event":"Edit Event"}),e.jsxs("label",{className:"block mb-2",children:["Date & Time:",e.jsx("input",{type:"datetime-local",name:"date",value:X(u.date),onChange:b,className:"border rounded px-2 py-1 w-full"})]}),e.jsxs("label",{className:"block mb-2",children:["Title:",e.jsx("input",{type:"text",name:"title",value:u.title,onChange:b,className:"border rounded px-2 py-1 w-full"})]}),e.jsxs("label",{className:"block mb-2",children:["Notes:",e.jsx("textarea",{name:"notes",value:u.notes,onChange:b,className:"border rounded px-2 py-1 w-full"})]}),e.jsxs("label",{className:"block mb-2",children:[e.jsx("input",{type:"checkbox",name:"isAddress",checked:N,onChange:b,className:"mr-2"}),"Is address"]}),N&&e.jsxs("label",{className:"block mb-4",children:["Address:",e.jsx("input",{type:"text",name:"address",value:u.address,onChange:b,className:"border rounded px-2 py-1 w-full"})]}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx("button",{onClick:S,className:"px-4 py-2 border rounded",children:"Cancel"}),e.jsx("button",{onClick:R,className:"px-4 py-2 bg-blue-500 text-white rounded",children:x==="add"?"Add":"Save"})]})]})})]})},te=Q(ee),se=window.appData||[],ne=document.getElementById("timeline-root"),re=_.createRoot(ne);re.render(e.jsx(P.StrictMode,{children:e.jsx(te,{events:se})}));
