# Phase 7.2 â€” Authentication And Authorization

## What To Learn
Authentication is JWT-based and configured in `Program.cs`. Authorization is enforced via endpoint filters and permission checks.

## Why It Exists
Pupil data access must be restricted to authorized users and services.

## Where It Lives In The Codebase
- Auth provider registration: `sonar-api/sonar-api/src/AuthProviderRegistration.cs`
- API pipeline: `sonar-api/sonar-api/src/Program.cs`
- Permission filters: `sonar-api/sonar-api/src/Middleware/RequiresPermissionEndpointFilters.cs`

## Authentication Flow
1. JWT bearer authentication validates incoming tokens.
2. Authenticated user details are resolved and stored in context.
3. Endpoint filters enforce permissions and feature access.

## Questions And Answers
- **How does the API determine the current school context?**
  - The authenticated user context includes `CurrentSchoolId`, derived from claims or user data.

## Additional Questions You Should Be Able To Answer
- Where is CORS enforced in relation to auth?
  - CORS policies are configured in `Program.cs` before request handling.

## Completion Check
You can trace authentication from JWT validation to permission enforcement.
