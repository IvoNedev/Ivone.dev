# Phase 8.4 â€” Practical Threat Model

## What To Learn
The main threats include unauthorized access across schools, misuse of machine keys, and exposure through PDF exports.

## Why It Exists
Threat modeling helps you identify where mistakes lead to privacy or integrity breaches.

## Where It Lives In The Codebase
- Machine-key middleware: `sonar-api/sonar-api/src/Middleware/MachineKeyAuthenticationMiddleware.cs`
- Permission filters: `sonar-api/sonar-api/src/Middleware/RequiresPermissionEndpointFilters.cs`
- CORS configuration: `sonar-api/sonar-api/src/Program.cs`

## Key Threats
- Cross-school data access if `CurrentSchoolId` is not enforced.
- Machine-key leakage enabling unauthorized batch operations.
- PDF outputs being shared beyond intended recipients.

## Questions And Answers
- **Where are machine keys validated?**
  - In `MachineKeyAuthenticationMiddleware`, which reads the `MachineKey` header and compares it to configured values.

## Additional Questions You Should Be Able To Answer
- Why does the system use both JWT and machine keys?
  - JWT is for user access, machine keys are for service-to-service automation.

## Completion Check
You can identify the main threats and describe the code locations where mitigation occurs.
