# Phase 3.1 — System Architecture (Described In Words)

## What To Learn
Sonar is a multi-component system consisting of frontends, a central API, a SQL database, caching and queue infrastructure, and background services.

## Why It Exists
Understanding the architectural boundaries prevents unsafe changes and helps diagnose issues.

## Where It Lives In The Codebase
- API entry: `sonar-api/sonar-api/src/Program.cs`
- Frontend roots: `sonar/sonar-web`, `sonar/reports-web`, `sonar-multischool/sonar-ms-web`
- Workers: `sonar-api/sonar-queue-processor`, `sonar-api/sonar-queue-runner`, `sonar-api/sonar-wonde-runner`

## Architecture Diagram In Words
1. **Clients**
   - Sonar Web (main UI)
   - Reports Web (reporting UI)
   - Multi-school Web (multi-school UI)
2. **API Layer**
   - Sonar API (primary business logic, permissions, and data access)
3. **Data Stores**
   - SQL Server (core data)
   - Redis (caching and data protection keys)
4. **Messaging/Async**
   - RabbitMQ (queueing)
   - Queue processor and runner services
5. **Document Generation**
   - HTML-to-PDF service triggered via API endpoint

## Questions And Answers
- **Which services are deployed independently?**
  - API, Reports Web, Sonar Web, Multi-school Web, queue processor, queue runner, document generation, and integration runners are all independently deployable.

- **Where does PDF generation occur and how is it invoked?**
  - Reports Web sends HTML to the API’s `/reportpdf` endpoint, and document generation produces the PDF.

## Additional Questions You Should Be Able To Answer
- Why is caching required?
  - Many report endpoints are read-heavy; caching reduces database load and improves response time.

- Why use queue-based processing?
  - Data preparation and external syncs are too heavy for synchronous requests.

## Completion Check
You can describe all major components and explain how data flows between them.
