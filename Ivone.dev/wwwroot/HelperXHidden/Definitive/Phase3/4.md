# Phase 3.4 — External Dependencies And Integrations

## What To Learn
Sonar depends on external services for identity, queueing, caching, storage, and integrations. These are configured at runtime and are required for production operation.

## Why It Exists
A system with incorrect external configuration may appear broken even when code is correct. Knowing dependencies is essential for debugging and deployment.

## Where It Lives In The Codebase
- Configuration: `sonar-api/sonar-api/src/appsettings.json`
- Authentication setup: `sonar-api/sonar-api/src/AuthProviderRegistration.cs`
- Queue configuration: `sonar-api/sonar-api/src/Infrastructure/Queue/QueueRegistration.cs`
- Cache configuration: `sonar-api/sonar-api/src/Infrastructure/Cache/*`
- Storage settings: `sonar-api/sonar-api/src/appsettings.json` (StorageSettings)

## Core Dependencies
1. **Identity Providers**
   - Auth0 and Juniper Portal (FusionAuth) configured under `Auth` in `appsettings.json`.
   - Used for JWT validation and user identity mapping.

2. **SQL Server**
   - Core data store, configured under `ConnectionStrings`.

3. **Redis**
   - Caching and data protection keys.

4. **RabbitMQ**
   - Queueing for background processing.

5. **Storage Providers**
   - Local file system, Azure, or AWS S3 depending on configuration.

## Questions And Answers
- **Which integrations are mandatory for dev vs optional?**
  - Mandatory: SQL Server, authentication provider, and CORS origins. Optional for dev: some external integrations if not actively used.

- **Which integrations are security-sensitive?**
  - Identity providers, machine keys, and storage credentials. These govern access and data leakage risk.

## Additional Questions You Should Be Able To Answer
- Where are machine keys configured?
  - Under `MachineKeys` in `appsettings.json` and used by middleware.

- How is CORS configured?
  - CORS sections are loaded in `sonar-api/sonar-api/src/Program.cs` to allow specific frontend origins.

## Completion Check
You can list Sonar’s external dependencies, explain what each is used for, and point to their configuration locations.
