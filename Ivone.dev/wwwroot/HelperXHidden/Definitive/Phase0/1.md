# Phase 0.1 — What This Product Is (Sonar Platform Scope)

## What To Learn
Sonar is a UK school assessment and reporting platform. It collects assessment data, transforms it into progress and attainment views, and delivers reports for teachers and school leaders. It supports multiple frontends that share a single API and a shared domain model.

## Why It Exists
UK schools must track pupil progress term-by-term, monitor cohort performance, and produce statutory outcomes. Sonar exists to centralize these workflows and to provide consistent reporting across different assessment types and school phases.

## Where It Lives In The Codebase
- API entry and configuration: `sonar-api/sonar-api/src/Program.cs`
- Route registration (the API surface): `sonar-api/sonar-api/src/RoutesRegistration.cs`
- Main UI (tracker): `sonar/sonar-web/src`
- Reports UI (reporting and PDF): `sonar/reports-web/src`
- Multi-school UI: `sonar-multischool/sonar-ms-web/src`
- Data model (entities): `sonar-api/sonar-data/Entity`
- Shared domain utilities (assessment points, feature keys): `sonar-api/sonar-utilities/src`

## Product Boundaries (What Sonar Is And Is Not)
- Sonar is not a generic SIS/MIS; it is focused on assessment, reporting, and outcomes.
- Sonar is not a static reporting site; it is dynamic, filter-driven, and tied to time-bound assessment points.
- Sonar is not just a UI; the API and background services contain the business logic that defines outcomes.

## Key Components And Their Roles
- **Sonar Web (`sonar/sonar-web`)**: The main application UI where staff access day-to-day workflows.
- **Reports Web (`sonar/reports-web`)**: The report rendering and PDF export UI; specialized for reporting flows.
- **Sonar API (`sonar-api/sonar-api`)**: Core business logic, data access, permissions, and report orchestration.
- **Worker/Runner Services (`sonar-api/sonar-queue-*`, `sonar-api/sonar-wonde-runner`)**: Async processing and integration orchestration.
- **Document Generation (`sonar-api/sonar-document-generation`)**: HTML-to-PDF conversion engine.

## How The Pieces Fit Together
1. A user signs in to Sonar Web or Reports Web.
2. The frontend sends filter-driven requests to Sonar API.
3. Sonar API queries SQL Server via entities and stored procedures.
4. For heavy tasks (data preparation, some report pipelines), the API queues work for background processors.
5. Reports Web renders report views and can export PDF via the API’s report PDF endpoint.

## Concrete System Facts From Code
- Authentication is JWT-based with explicit authorization in `sonar-api/sonar-api/src/Program.cs`.
- API routes are registered via `app.RegisterSonarApiNetRoutes()` in `sonar-api/sonar-api/src/Program.cs`.
- Reports Web is a separate build (`sonar/reports-web`) with its own print/PDF flow (`sonar/reports-web/src/app/component/common/DownloadButton.tsx`).

## Questions And Answers
- **Which major services exist and which are “core” vs “supporting”?**
  - Core: `sonar-api`, `sonar-web`, `reports-web`.
  - Supporting: `sonar-queue-processor`, `sonar-queue-runner`, `sonar-wonde-runner`, `sonar-document-generation`.

- **Where do the web frontends live relative to the API?**
  - Frontends are in the `sonar` and `sonar-multischool` repos; API is in `sonar-api`.

- **Which repositories are in scope for daily changes?**
  - Day-to-day changes typically span `sonar-api` (logic) and `sonar` (UI). Multi-school work also touches `sonar-multischool`.

## Additional Questions You Should Be Able To Answer
- What is the boundary between Reports Web and Sonar Web?
  - Reports Web focuses on report rendering, filtering, and PDF export; Sonar Web is the broader product UI.

- Where does the system convert HTML to PDF?
  - Reports Web captures HTML and sends it to the API’s `/reportpdf` endpoint, which forwards to the document generation pipeline.

## Completion Check
You can explain Sonar’s scope, list its major components, and point to the exact folders where each component lives.
