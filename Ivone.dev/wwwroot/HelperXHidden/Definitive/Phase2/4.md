# Phase 2.4 — Non-Obvious Constraints From Education Reality

## What To Learn
Educational data is messy: assessments do not always occur on schedule, cohorts move, and historical data must still be reportable. Sonar encodes these realities in effective assessments and assessment point logic.

## Why It Exists
If the system assumes perfect timelines, reports become misleading. Sonar must handle missing data and term misalignment.

## Where It Lives In The Codebase
- Assessment points: `sonar-api/sonar-utilities/src/AssessmentPoint.cs`
- Effective assessments evaluator: `sonar-api/sonar-api/src/Areas/Assessment/EffectiveAssessmentsModeEvaluator.cs`
- Effective assessments calculator: `sonar-api/sonar-api/src/Areas/SummativeAssessments/SummativeEffectiveAssessmentCalculator.cs`
- Progress meeting report: `sonar-api/sonar-api/src/Areas/Reports/PupilProgressMeeting/PupilProgressMeetingHandler.cs`

## Constraint 1: Out-of-Sequence Assessment Entry
- Teachers might enter data late or skip a term.
- Effective assessment mode treats the most recent prior assessment as the “current” value for reporting.
- `SummativeEffectiveAssessmentCalculator` picks the latest assessment at or before the target assessment point.

## Constraint 2: Special Assessment Points
- The end-of-year projection (TermId 99) is not a real term but is used for projections.
- The system must allow reporting on this pseudo-term as if it were a valid assessment point.

## Constraint 3: Cohort Movement
- Pupils move between classes, and year group assignments change each academic year.
- Reports must handle cohorts that are defined by filters rather than static groups.

## Questions And Answers
- **How does Sonar handle out-of-sequence assessment points?**
  - If effective assessments mode is enabled, the system derives a current assessment from the latest previous data, using `SummativeEffectiveAssessmentCalculator`.

- **How are cohorts and year groups recalculated?**
  - Cohorts are derived dynamically from pupil filters and current year group data; they are not fixed lists.

## Additional Questions You Should Be Able To Answer
- Why is effective assessments mode a permission-based feature?
  - The system allows administrators to disable it via `Permission.DisableEffectiveAssessments`.

- What happens if a term ID is unknown?
  - `AssessmentPoint.GetTermLabel()` throws `ArgumentOutOfRangeException`, indicating the term configuration must be valid.

## Completion Check
You can explain effective assessments, the role of special assessment points, and why cohort definitions are dynamic.
