# Phase 2.3 â€” Critical Business Rules

## What To Learn
Business rules define how assessment data becomes progress outcomes and statutory results. These rules are encoded in calculators, feature keys, and data access logic.

## Why It Exists
Changing these rules changes real-world reporting and can create compliance issues.

## Where It Lives In The Codebase
- Feature keys: `sonar-api/sonar-utilities/src/FeatureKey.cs`
- Statutory calculations: `sonar-api/sonar-api/src/Areas/Statutory/HeadlineCalculators/*`
- ARE calculations: `sonar-api/sonar-api/src/Areas/Reports/Common/Orchestrators/AreAssessmentOrchestrator.cs`
- Test score ARE logic: `sonar-api/sonar-api/src/Areas/TestScores/TestPaperAssessmentOrchestrator.cs`

## Rule Categories
1. **Feature-Based Rules**
   - The feature key determines which assessment models and code sets apply.
   - Example: `FeatureKey.EYFS_2020_Summative_PITA` indicates EYFS 2020 summative logic.

2. **Assessment Point Rules**
   - Progress depends on ordered assessment points and term comparisons.
   - The `AssessmentPointCode` ensures consistent ordering.

3. **ARE Mapping Rules**
   - Summative assessments are mapped to ARE categories using age-related expectation ranges.
   - Test score assessments are mapped using score ranges and out-of-band logic.

4. **Statutory Headline Rules**
   - Statutory headlines are defined by year group and subject.
   - Headline calculators map raw results to statutory expectations.

## Questions And Answers
- **Where are statutory rules encoded and configured?**
  - They are encoded in the statutory calculators under `sonar-api/sonar-api/src/Areas/Statutory/HeadlineCalculators` and orchestrated by `StatutoryHeadlineOrchestrator`.

- **Which rules are defined in code vs SQL functions?**
  - Core reporting rules are in C# orchestration and calculators; legacy code sets and lookups may be backed by SQL procedures or functions.

## Additional Questions You Should Be Able To Answer
- Why is `FeatureKey` central to business rules?
  - It defines which assessment model applies, which influences codes, ranges, and report behavior.

- How do effective assessments alter business rules?
  - Effective assessments derive a current term value from prior assessments, affecting progress logic.

## Completion Check
You can identify the primary sources of business rules in code, explain how feature keys drive behavior, and point to statutory and ARE calculation logic.
