# Phase 2.5 â€” Where Business Logic Lives (And Where It Should Not)

## What To Learn
Business logic must be centralized in the API and shared libraries. UI logic should be presentation-only, and legacy SQL functions should be treated as authoritative for their specific paths.

## Why It Exists
Duplicate logic in UI and API leads to inconsistent reports and regressions.

## Where It Lives In The Codebase
- API handlers and orchestrators: `sonar-api/sonar-api/src/Areas/*`
- Shared utilities: `sonar-api/sonar-utilities/src/*`
- Stored procedures and wrappers: `sonar-api/sonar-api/src/StoredProcedures/*`
- UI helpers: `sonar/reports-web/src/app/helpers/*`

## Logic That Must Live In The API
- Statutory calculations.
- ARE classification logic.
- Effective assessment rules.
- Any logic that must be consistent across multiple UIs.

## Logic That May Live In The UI
- Rendering decisions.
- Layout and presentation.
- Minor formatting for display.

## Logic That Should Be Avoided In The UI
- Business rule decisions (e.g., expectation thresholds).
- Data transformations that affect report correctness.

## Questions And Answers
- **Which calculations are duplicated in UI vs API?**
  - UI sometimes derives display-only metrics; core calculations such as ARE and statutory outcomes belong to the API.

- **Where are legacy SQL functions still authoritative?**
  - Legacy reporting and lookup logic is often implemented in stored procedures or SQL functions referenced by data access layers.

## Additional Questions You Should Be Able To Answer
- How can you tell if a calculation belongs in UI or API?
  - If it affects report correctness or is used by multiple clients, it belongs in the API or shared library.

- What is the risk of copying API logic into UI?
  - Divergence over time and inconsistent reporting across clients.

## Completion Check
You can distinguish presentation logic from business logic and identify the authoritative code locations for calculations.
