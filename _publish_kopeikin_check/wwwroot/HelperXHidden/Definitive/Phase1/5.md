# Phase 1.5 — Legal, Safeguarding, and Data Sensitivity

## What To Learn
Sonar handles child data. Access is controlled, data scope is limited by school context, and outputs must be auditable and defensible.

## Why It Exists
Misuse or leakage of child data is a compliance risk and a safeguarding risk. The system must maintain strict access boundaries.

## Where It Lives In The Codebase
- Auth and authorization: `sonar-api/sonar-api/src/Program.cs`, `sonar-api/sonar-api/src/Middleware/*`
- User context: `sonar-api/sonar-api/src/UserAuthentication/*`
- Role entities: `sonar-api/sonar-data/Entity/*Role*`
- Report export: `sonar/reports-web/src/app/component/common/DownloadButton.tsx`

## Safeguarding Principles In Code
- **School-level scoping**: API requests are bound to `CurrentSchoolId` and filtered to that scope.
- **Role-based access**: Endpoint filters check permissions before data access.
- **Least privilege**: Reports and endpoints are grouped by purpose and require explicit permissions.

## PDF/Data Sharing Considerations
- PDF export increases the risk of data being shared externally.
- The system provides PDF export to meet governance needs, but data access is still permission-limited.

## Questions And Answers
- **Which data flows are sensitive and require auditing?**
  - Assessment creation and changes, observation data, and statutory outcome generation.

- **Which data must be retained vs can be deleted?**
  - Retention policies are external to this repo, but the system’s audit and permission model assumes long-term retention of assessment outcomes.

## Additional Questions You Should Be Able To Answer
- Where is the authenticated user context created?
  - In `sonar-api/sonar-api/src/Program.cs` and the related middleware that populates `IAuthenticatedUser`.

- How can a developer ensure a new endpoint respects safeguarding rules?
  - Use existing endpoint filters for permission and feature checks, and scope all queries by school ID.

## Completion Check
You can explain why data access is scoped, identify the access enforcement points, and describe how PDFs increase data sharing risk.
